var fs = require('fs');
 
function File() {
	function open(path, document) {
		var a = path.substring(0,path.lastIndexOf("\\"))
		document.getElementById('txt').value= a;
		fs.readFile(path, 'utf-8', function (error, contents) {
			document.getElementById('editor').value = contents;
		});
		execAsync(document.getElementById('res'),'build.bat',a);
	}
     
	function save(path, document) {
		var text = document.getElementById('editor').value;
		console.log(text);
		fs.writeFile(path, text);
	}
	function execAsync(id,proc,arg)
	{
		var spawn = require('child_process').spawn,
		ls    = spawn(proc, [arg, '']);
		ls.stdout.on('data', function (data) {
			id.innerHTML = id.innerHTML+'' + data+'<br />';
		});

		ls.stderr.on('data', function (data) {
			id.innerHTML = id.innerHTML+'stderr: ' + data+'<br />';
		});

		ls.on('close', function (code) {
		  id.innerHTML = id.innerHTML+'child process exited with code ' + code+'<br />';
		});
	}
    this.open = open;
    this.save = save;
	this.execAsync = execAsync;
}
 
module.exports = new File;
